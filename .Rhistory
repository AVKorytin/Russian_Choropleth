<<<<<<< HEAD
r <- readRDS("RUS_adm2.rds")
u <- readRDS("UKR_adm2.rds")
head(u@data)
table(u$NAME_1)
u@data[1:23+23+25+11,]
u@data[0:24+23+25+11,]
1:23+23+25+11
u@data[u$NAME_1=="Sevastopol'",]
which(u$NAME_1=="Sevastopol'")
which(u$NAME_1=="Sevastopol'"|u$NAME_1=="Crimea")
which(u$NAME_1==("Sevastopol'"|"Crimea")
)
which(u$NAME_1=="Sevastopol'|Crimea"
)
which(u$NAME_1 %in% c("Sevastopol'","Crimea"))
table(r$NAME_1)
plot(r)
for(i in which(r$NAME_1=="Chukot")) {
for(j in 1:length(r@polygons[[i]]@Polygons)) {
r@polygons[[i]]@Polygons[[j]]@coords[,1] <-
sapply(r@polygons[[i]]@Polygons[[j]]@coords[,1],function(x) ifelse(x<0,359.999+x,x))
}}
plot(r)
r@bbox
r@bbox[1,1]
r@bbox[1,1] <- 0
plot(r)
r2 <- rbind(r, u[u$NAME_1 %in% c("Sevastopol'","Crimea"),])
u@polygons[[1]]@Polygons[[1]]
u@polygons[[1]]@plotOrder
u@plotOrder
u@polygons[[1]]@ID
dim(r@data)
class(u@polygons[[1]]@ID)
cr <- u[u$NAME_1 %in% c("Sevastopol'","Crimea"),]
ength(cr@polygons)
length(cr@polygons)
sapply(cr@polygons, function(x) x@ID)
for(i in 1:length(cr@polygons)) cr@polygons[[i]]@ID <- paste0("u", cr@polygons[[i]]@ID)
sapply(cr@polygons, function(x) x@ID)
r2 <- rbind(r, cr)
row.names(cr@data)
for(i in 1:length(cr@polygons)) cr@polygons[[i]]@ID <- as.numeric(cr@polygons[[i]]@ID)+10^4
cr <- u[u$NAME_1 %in% c("Sevastopol'","Crimea"),]
for(i in 1:length(cr@polygons)) cr@polygons[[i]]@ID <- as.numeric(cr@polygons[[i]]@ID)+10^4
for(i in 1:length(cr@polygons)) cr@polygons[[i]]@ID <- paste0("u", cr@polygons[[i]]@ID)
row.names(cr@data) <- sapply(cr@polygons, function(x) x@ID)
r2 <- rbind(r, cr)
getSmallPolys <- function(poly, minarea=0.01) {
# Get the areas
areas <- lapply(poly@polygons, function(x) sapply(x@Polygons, function(y) y@area))
# Quick summary of the areas
print(quantile(unlist(areas)))
# Which are the big polygons?
bigpolys <- lapply(areas, function(x) which(x > minarea))
length(unlist(bigpolys))
# Get only the big polygons
for(i in 1:length(bigpolys)) {
poly@polygons[[i]]@Polygons <- poly@polygons[[i]]@Polygons[bigpolys[[i]]]
poly@polygons[[i]]@plotOrder <- 1:length(poly@polygons[[i]]@Polygons)
}
return(poly)
}
r2 <- getSmallPolys(rbind(r, cr))
plot(r2)
plot(r2)
r2 <- rbind(r, cr)
plot(r2)
cr <- u[u$NAME_1 %in% c("Sevastopol'","Crimea"),]
for(i in 1:length(cr@polygons)) cr@polygons[[i]]@ID <- paste0("100", cr@polygons[[i]]@ID)
row.names(cr@data) <- sapply(cr@polygons, function(x) x@ID)
r2 <- getSmallPolys(rbind(r, cr))
plot(r2)
r2@plotOrder
tail(r2@plotOrder)
sum(duplicated(r2@plotOrder))
length(duplicated(r2@plotOrder))
length(duplicated(r@plotOrder))
cr <- u[u$NAME_1 %in% c("Sevastopol'","Crimea"),]
for(i in 1:length(cr@polygons)) cr@polygons[[i]]@ID <- paste0("u", cr@polygons[[i]]@ID)
row.names(cr@data) <- sapply(cr@polygons, function(x) x@ID)
r2 <- getSmallPolys(rbind(r, cr))
r2@polygons <- lapply(r2@polygons, "comment<-", NULL)
plot(r2)
require(rgeos)
install.packages("rgeos")
install.packages("rgeos")
require(rgeos)
sr <- rgeos::gSimplify(spgeom = gadm3, tol = 0.05, topologyPreserve = FALSE)
sr <- rgeos::gSimplify(spgeom = r2, tol = 0.05, topologyPreserve = FALSE)
plot(sr)
r3 <- SpatialPolygonsDataFrame(sr, r2@data, match.ID = TRUE)
length(sr@polygons)
sr <- rgeos::gSimplify(spgeom = r2, tol = 0.1, topologyPreserve = FALSE)
sr <- rgeos::gSimplify(spgeom = r2, tol = 0.05, topologyPreserve = FALSE)
sr <- rgeos::gSimplify(spgeom = r2, tol = 0.03, topologyPreserve = FALSE)
sr <- rgeos::gSimplify(spgeom = r2, tol = 0.02, topologyPreserve = FALSE)
sr <- rgeos::gSimplify(spgeom = r2, tol = 0.01, topologyPreserve = FALSE)
sr <- rgeos::gSimplify(spgeom = r2, tol = 0.05, topologyPreserve = T)
sr <- rgeos::gSimplify(spgeom = r2, tol = 0.025, topologyPreserve = T)
sr <- rgeos::gSimplify(spgeom = r2, tol = 0.01, topologyPreserve = T)
sr <- rgeos::gSimplify(spgeom = r2, tol = 0.05, topologyPreserve = FALSE)
x <- sapply(sr@polygons, function(x) x@ID)
row.names(r2@data)[!(row.names(r2@data) %in% x)]
y <- row.names(r2@data)[!(row.names(r2@data) %in% x)]
plot(r2[y,])
y <- which(!(row.names(r2@data) %in% x))
plot(r2[y,])
y <- sapply(r2@polygons, function(x) x@ID)
plot(r2[!(y %in% x)])
head(y)
head(x)
plot(r2[!(y %in% x),])
rus <- readRDS("rus.Rds")
class(rus)
g4 <- readRDS("gadm4.Rds")
plot(sr)
plot(g4, border = "red", add = TRUE, lwd = 2)
length(x)
length(y)
which(!(y %in% x))
plot(r2)
plot(sr, border = "red", add = TRUE)
x_ <- SpatialPolygonsDataFrame(sr, r2@data[1:2038], match.ID = TRUE)
x <- merge(fortify(x_, region = "ID_1"), x_@data, by.x = "id", by.y = "ID_1", all.x = TRUE)
ggplot(data = x, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = ID_1), color = "white") +
coord_map(projection = 'azequidist') +
guides(fill=FALSE)
require(ggplot2)
x_ <- SpatialPolygonsDataFrame(sr, r2@data[1:2038,], match.ID = TRUE)
x <- merge(fortify(x_, region = "ID_1"), x_@data, by.x = "id", by.y = "ID_1", all.x = TRUE)
p <- ggplot(data = x, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = ID_1), color = "white") +
coord_map(projection = 'azequidist') +
guides(fill=FALSE)
p
head(x)
p <- ggplot(data = x, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = id), color = "white") +
coord_map(projection = 'azequidist') +
guides(fill=FALSE)
p
x <- merge(fortify(x_, region = "ID_2"), x_@data, by.x = "id", by.y = "ID_2", all.x = TRUE)
p <- ggplot(data = x, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = id), color = "white") +
coord_map(projection = 'azequidist') +
guides(fill=FALSE)
p
head(x_@data)
p <- ggplot(data = x_, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = id), color = "white") +
coord_map(projection = 'azequidist') +
guides(fill=FALSE)
p
head(x)
p <- ggplot(data = x_, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = group), color = "white") +
coord_map(projection = 'azequidist') +
guides(fill=FALSE)
p
=======
gadm2@data
plot(gadm2[35,])
res <- rgeos::gSimplify(spgeom = gadm2[35,], tol = 0.05, topologyPreserve = FALSE)
plot(res)
res <- rgeos::gSimplify(spgeom = gadm2[35,], tol = 0.05, topologyPreserve = T)
plot(res)
res <- rgeos::gSimplify(spgeom = gadm2, tol = 0.05, topologyPreserve = T)
plot(res)
t <- proc.time()
plot(gadm2)
proc.time()-t
t <- proc.time()
plot(res)
proc.time()-t
res1 <- rgeos::gSimplify(spgeom = gadm2, tol = 0.05, topologyPreserve = F)
t <- proc.time()
plot(res1)
proc.time()-t
res <- rgeos::gSimplify(spgeom = gadm2, tol = 0.1, topologyPreserve = T)
t <- proc.time()
plot(res)
proc.time()-t
lapply(gadm2@polygons, function(x) sapply(x@Polygons, function(y) y@area))
print(quantile(unlist(areas)))
areas <- lapply(gadm2@polygons, function(x) sapply(x@Polygons, function(y) y@area))
print(quantile(unlist(areas)))
hist(unlist(areas))
qplot(unlist(areas))
qplot(unlist(areas), xlim = c(0, 100))
qplot(unlist(areas), xlim = c(-1, 100))
qplot(unlist(areas), xlim = c(-10, 100))
qplot(unlist(areas), xlim = c(-1, 28), binwidth = 1)
qplot(unlist(areas), xlim = c(-1, 2), binwidth = 0.01)
source('~/R/Scripts/maps.R', encoding = 'UTF-8')
gadm3 <- getSmallPolys(gadm2)
bigpolys <- lapply(areas, function(x) which(x > 0.01))
bigpolys
gadm2@data[66,]
plot(gadm2[66,])
plot(gadm2[65,])
plot(gadm2[67,])
gadm2@data[67,]
plot(gadm2[68,])
gadm2 <- gadm2[-c(67,68),]
gadm3 <- getSmallPolys(gadm2)
areas <- lapply(gadm2@polygons, function(x) sapply(x@Polygons, function(y) y@area))
bigpolys <- lapply(areas, function(x) which(x > 0.01))
bigpolys
gadm <- readRDS("RUS_adm1.rds")
adm <- readRDS("UKR_adm1.rds")
gadm2 <- rbind(gadm[-c(67,68),], adm[c(4,20),])
gadm2 <- rbind(gadm[-c(66,67),], adm[c(4,20),])
gadm3 <- getSmallPolys(gadm2)
areas <- lapply(gadm2@polygons, function(x) sapply(x@Polygons, function(y) y@area))
bigpolys <- lapply(areas, function(x) which(x > 0.01))
bigpolys
source('~/R/Scripts/maps.R', encoding = 'UTF-8')
gadm3 <- getSmallPolys(gadm2)
plot(gadm3)
t <- proc.time()
plot(gadm3)
proc.time()-t
gadm@polygons[68]
plot(gadm2[68,])
plot(gadm[68,])
gadm@polygons[68][[3]]
gadm@polygons[68][[1]][[3]]
gadm@polygons[68][[1]][3]
gadm@polygons[68][[1]]@Polygons[[3]]
gadm2@polygons[66][[1]]@Polygons[[3]] <- NULL
plot(gadm[68,])
plot(gadm2[66,])
gadm4 <- rgeos::gSimplify(spgeom = gadm3, tol = 0.1, topologyPreserve = F)
gadm2@polygons[66][[1]]@plotOrder
gadm2@polygons[66][[1]]@area
gadm2@polygons[66][[1]]@labpt
names(gadm2@polygons[66][[1]]@Polygons)
gadm2@polygons[66][[1]]@Polygons[[1]]
gadm2@polygons[66][[2]]
gadm2@data
gadm2@polygons[66][[1]]@plotOrder <- c(2,1)
class(gadm2@polygons[66][[1]]@plotOrder)
gadm2@polygons[66][[1]]@plotOrder
gadm2@polygons[66][[1]]@plotOrder <- c(2L,1L)
gadm2@polygons[66][[1]]@plotOrder
gadm3 <- getSmallPolys(gadm2)
gadm4 <- rgeos::gSimplify(spgeom = gadm3, tol = 0.1, topologyPreserve = F)
length(gadm3@polygons[1])
lapply(gadm2@polygons, function(x) sapply(x@Polygons, function(y) y@area))
lapply(gadm3@polygons, function(x) sapply(x@Polygons, function(y) y@area))
gadm3@data[4,]
plot(gadm3)
a <- lapply(gadm3@polygons, function(x) sapply(x@Polygons, function(y) y@area))
qplot(unlist(areas))
qplot(unlist(a))
qplot(unlist(a), xlim = c(0, 100))
quantile(unlist(a), seq(0, 1, 0.05))
length(unlist(a))
length(unlist(areas))
str(gadm3@polygons[4])
gadm4 <- rgeos::gSimplify(spgeom = gadm3, tol = 0.1, topologyPreserve = F)
slot(gadm3, "polygons") <- lapply(slot(gadm3, "polygons"), "comment<-", NULL)
gadm4 <- rgeos::gSimplify(spgeom = gadm3, tol = 0.1, topologyPreserve = F)
t <- proc.time()
plot(gadm3)
proc.time()-t
t <- proc.time()
plot(gadm4)
proc.time()-t
for(i in 1:length(gadm@polygons)){
for(j in 1:length(gadm@polygons[[i]]@Polygons)){
gadm@polygons[[i]]@Polygons[[j]]@coords[,1]<- sapply(gadm@polygons[[i]]@Polygons[[j]]@coords[,1], function(x){
if(x < 0){
x<-359.999+x
}
else{x}
})
}
}
gadm2 <- rbind(gadm[-c(66,67),], adm[c(4,20),])
gadm2@polygons[66][[1]]@Polygons[[3]] <- NULL
gadm2@polygons[66][[1]]@plotOrder <- c(2L, 1L)
gadm3 <- getSmallPolys(gadm2)
slot(gadm3, "polygons") <- lapply(slot(gadm3, "polygons"), "comment<-", NULL)
gadm4 <- rgeos::gSimplify(spgeom = gadm3, tol = 0.05, topologyPreserve = F)
t <- proc.time()
plot(gadm4)
proc.time()-t
length(gadm3@polygons)
dim(gadm3@data)
gadm4@data <- gadm3@data
class(gadm4)
class(gadm3)
library("sp", lib.loc="~/R/R-3.3.2/library")
sr <- rgeos::gSimplify(spgeom = gadm3, tol = 0.05, topologyPreserve = FALSE)
gadm4 <- SpatialPolygonsDataFrame(sr, gadm3@data, match.ID = TRUE)
gadm4@data$NAME_1
plot(gadm4[43])
plot(gadm4[43,])
plot(gadm3[43,])
plot(gadm4[43,])
plot(gadm4[85,])
plot(gadm4[84:85,])
require(ggplot2)
p <- ggplot(data = gadm4, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = id), color = "white") +
coord_map(projection = 'azequidist') +
guides(fill=FALSE)
plot(p)
plot(gadm4)
gadm4[85,]
plot(gadm4@polygons[[1]]@Polygons[[1]]@coords)
plot(gadm4@polygons[85][[1]]@Polygons[[1]]@coords)
plot(gadm4[85,])
plot(gadm3[85,])
plot(gadm4[85,], add=T, borders = "red")
plot(gadm4[85,], add=T, border = "red")
gadm4@polygons[85][[1]]@Polygons[[1]]@ringDir
class(gadm4@polygons[85][[1]]@Polygons[[1]]@coords)
gadm4@polygons[85][[1]]@Polygons[[1]]@coords[1]
m <- gadm4@polygons[85][[1]]@Polygons[[1]]@coords
m
m[2,] <- NULL
m[c(1,7,8,9),]
plot(m[c(1,7,8,9),], add=T, col = "blue")
gadm4@polygons[85][[1]]@Polygons[[1]]@coords <- gadm4@polygons[85][[1]]@Polygons[[1]]@coords[c(1,7:9,12),]
plot(gadm4[85,])
p <- ggplot(data = gadm4, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = id), color = "white") +
coord_map(projection = 'azequidist') +
guides(fill=FALSE)
plot(p)
gadm4@data$NAME_1
plot(gadm4[43,])
plot(gadm4[44,], add = T)
plot(gadm4[44,])
plot(gadm4[43,], add = T)
plot(gadm3[43,], add = T)
plot(gadm4[43,], add = T)
gadm4@plotOrder
gadm4@polygons[44]
gadm4@polygons[44][[1]]@Polygons[[1]]
gadm4@polygons[44][[1]]@Polygons
gadm4@polygons[44][[1]]@Polygons[[2]] <- gadm4@polygons[43][[1]]@Polygons[[1]]
gadm4@polygons[44][[1]]@Polygons[[2]]@hole <- TRUE
gadm4@polygons[44][[1]]@plotOrder <- c(1L, 2L)
p <- ggplot(data = gadm4, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = id), color = "white") +
coord_map(projection = 'azequidist') +
guides(fill=FALSE)
plot(p)
east <- lapply(gadm4@polygons, function(x) sapply(x@Polygons, function(y) max(y@coords[,"x"])))
east
sapply(east, max)
ord <- data.frame(id = 1:length(gadm4@data$NAME_1), name = gadm4@data$NAME_1, east, stringsAsFactors = FALSE)
class(x)
class(east)
east <- sapply(lapply(gadm4@polygons, function(x) sapply(x@Polygons, function(y) max(y@coords[,"x"]))), max)
ord <- data.frame(id = 1:length(gadm4@data$NAME_1), name = gadm4@data$NAME_1, east, stringsAsFactors = FALSE)
head(ord)
head(gadm4@data)
name <- gadm4@data$NL_NAME_1
ord <- data.frame(id = 1:length(name), name, east, stringsAsFactors = FALSE)
head(gadm4@data)
head(ord)
ord <- ord[ordered(ord$east),]
head(ord)
ord <- ord[order(ord$east),]
head(ord)
ord <- ord[order(ord$east, decreasing = TRUE),]
head(ord)
ord <- data.frame(id = 1:length(name), name, east, stringsAsFactors = FALSE)
order(ord$east, decreasing = TRUE)
eastern_rus <- order(east, decreasing = TRUE)[1:14]
eastern_rus
p <- ggplot(data = gadm4[-eastern_rus,], aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = id), color = "white") +
coord_map(projection = 'azequidist') +
guides(fill=FALSE)
plot(p)
gadm4@polygons[58]
plot(gadm4[58,])
gadm4@polygons[59]
plot(gadm4[59,])
gadm3@polygons[59]
plot(gadm3[59,], add=T)
plot(gadm3[59,])
sr59 <- rgeos::gSimplify(spgeom = gadm3[59,], tol = 0.05, topologyPreserve = FALSE)
plot(sr59)
sr59 <- rgeos::gSimplify(spgeom = gadm3[59,], tol = 0.05, topologyPreserve = TRUE)
plot(sr59)
sr59 <- rgeos::gSimplify(spgeom = gadm3[59,], tol = 0.03, topologyPreserve = FALSE)
plot(sr59)
str(sr59)
sr59_ <- rgeos::gSimplify(spgeom = gadm3[59,], tol = 0.05, topologyPreserve = TRUE)
str(sr59_)
sr <- rgeos::gSimplify(spgeom = gadm3, tol = 0.05, topologyPreserve = FALSE)
sr[59,] <- sr59
class(sr)
plot(sr[59,])
plot(sr[59])
sr[59] <- sr59
sr$`410`
sr$`1`
sr@polygons[59]
sr59@polygons[1][[1]]@Polygons[[1]]@coords
sr59 <- rgeos::gSimplify(spgeom = gadm3[59,], tol = 0.05, topologyPreserve = TRUE)
sr59@polygons[1][[1]]@Polygons[[1]]@coords
gadm4@polygons[59][[1]]@Polygons[[1]]@coords
1:10L
m <- 1:10L
class(m)
dim(gadm4@polygons[59][[1]]@Polygons[[1]]@coords)
gadm4@polygons[59][[1]]@Polygons[[1]]@coords <- sr59@polygons[1][[1]]@Polygons[[1]]@coords
p <- ggplot(data = gadm4[-eastern_rus,], aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = id), color = "white") +
coord_map(projection = 'azequidist') +
guides(fill=FALSE)
plot(p)
saveRDS(gadm4, "gadm4.Rds")
rus <- fortify(gadm4)
head(rus)
str(rus)
levels(rus$group)
levels(rus$piece)
plot(rus)
plot(rus$long, rus$lat)
plot(rus$long[rus$piece=="1"], rus$lat[rus$piece=="1"])
plot(rus$long[rus$piece=="2"], rus$lat[rus$piece=="2"])
plot(rus$long[rus$piece=="3"], rus$lat[rus$piece=="3"])
levels(factor(rus$id))
plot(rus$long[rus$id=="410"], rus$lat[rus$id=="410"])
plot(rus$long[rus$id=="201"], rus$lat[rus$id=="201"])
plot(rus$long[rus$id=="32"], rus$lat[rus$id=="32"])
head(gadm4@data)
install.packages("ggmap")
library(ggmap)
mapgilbert <- get_map(location = c(lon = 37.62, lat = 55.73),
zoom = zoom, maptype = "watercolor", scale = 2)
mapgilbert <- get_map(location = c(lon = 37.62, lat = 55.73),
zoom = 10, maptype = "watercolor", scale = 2)
ggmap(mapgilbert)
mapgilbert <- get_map(location = c(lon = 37.62, lat = 55.73),
zoom = 5, maptype = "watercolor", scale = 2)
library(ggmap)
ggmap(mapgilbert)
mapgilbert <- get_map(location = c(lon = 77.62, lat = 55.73),
zoom = 4, maptype = "watercolor", scale = 2)
ggmap(mapgilbert)
mapgilbert <- get_map(location = c(lon = 77.62, lat = 55.73),
zoom = 4, maptype = "terrain", scale = 2)
ggmap(mapgilbert)
mapgilbert <- get_map(location = c(lon = 77.62, lat = 55.73),
zoom = 4, maptype = "satellite", scale = 2)
ggmap(mapgilbert)
rus <- merge(fortify(gadm4, region = "ID_1"), gadm4@data, by = "ID_1", all.x = TRUE)
rus <- fortify(gadm4)
rus <- fortify(gadm4, region = "ID_1")
rus <- merge(fortify(gadm4), gadm4@data, by.x = "id", by.y = "ID_1", all.x = TRUE)
head(rus)
p <- ggplot(data = rus, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = id), color = "white") +
coord_map(projection = 'azequidist') +
guides(fill=FALSE)
plot(p)
p <- ggplot(data = fortify(gadm4), aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = id), color = "white") +
coord_map(projection = 'azequidist') +
guides(fill=FALSE)
plot(p)
rus <- fortify(gadm4)
df <- data.frame(id = c(1:levels(factor(rus$id))), x = 1:85)
df <- data.frame(id = c(1:levels(factor(rus$id))), x = 1:85, stringsAsFactors = F)
head(df)
df <- data.frame(id = levels(factor(rus$id)), x = 1:85, stringsAsFactors = F)
head(df)
eastern_rus <- gadm4[order(east, decreasing = TRUE),]
head(eastern_rus)
head(eastern_rus@data)
eastern_rus@data$ID_1
eastern_rus@data$OBJECTID
rus <- fortify(eastern_rus)
levels(factor(rus$id))
slot(eastern_rus, "polygons") <- lapply(slot(eastern_rus, "polygons"), "comment<-", NULL)
rus <- fortify(gadm4, region = "ID_1")
slot(eastern_rus, "Polygons") <- lapply(slot(eastern_rus, "Polygons"), "comment<-", NULL)
eastern_rus@polygons[1][[1]]@ID
sapply(eastern_rus@polygons, function(x) x@ID)
class(eastern_rus@polygons[1][[1]]@ID)
slot(eastern_rus@polygons[1][[1]])
slot(eastern_rus@polygons[1][[1]]@ID)
slot(eastern_rus@polygons[1][[1]]@ID, name)
slot(eastern_rus@polygons[1][[1]], name = "ID")
gadm4@polygons[85][[1]]@Polygons[[1]]@coords
gadm4@polygons[[85]]@Polygons[[1]]@coords
load("RUS_adm1.rds")
gadm <- readRDS("RUS_adm1.rds")
gadm@data[12,]
gadm@polygons[[12]]@Polygons
x <- lapply(gadm@polygons[[12]]@Polygons, function(y) y@coords[,1] <-
sapply(gadm@polygons[[12]]@Polygons[[j]]@coords[,1], function(x) if(x<0) x<-359.999+x else x))
x <- lapply(gadm@polygons[[12]]@Polygons, function(y) y@coords[,1] <-
sapply(y@coords[,1], function(x) if(x<0) x<-359.999+x else x))
plot(x)
gadm@polygons[[12]]@Polygons <- lapply(gadm@polygons[[12]]@Polygons, function(y) y@coords[,1] <-
sapply(y@coords[,1], function(x) if(x<0) x<-359.999+x else x))
plot(gadm[12,])
x
sapply(gadm@polygons[[12]]@Polygons[[1]]@coords[,1], function(x) if(x<0) x<-359.999+x else x)
gadm@polygons[[12]]@Polygons[[1]]@coords[,1]
gadm <- readRDS("RUS_adm1.rds")
gadm@polygons[[12]]@Polygons[[1]]@coords[,1]
gadm@polygons[[12]]@Polygons[[2]]@coords[,1]
sapply(gadm@polygons[[12]]@Polygons[[1]]@coords[,1], function(x) if(x<0) x<-359.999+x else x)
gadm@polygons[[12]]@Polygons[[3]]@coords[,1]
gadm@polygons[[12]]@Polygons[[4]]@coords[,1]
gadm@polygons[[12]]@Polygons[[5]]@coords[,1]
gadm@polygons[[12]]@Polygons[[6]]@coords[,1]
gadm@polygons[[12]]@Polygons[[7]]@coords[,1]
gadm@polygons[[12]]@Polygons[[8]]@coords[,1]
gadm@polygons[[12]]@Polygons[[9]]@coords[,1]
gadm@polygons[[12]]@Polygons[[90]]@coords[,1]
sapply(gadm@polygons[[12]]@Polygons[[90]]@coords[,1], function(x) if(x<0) x<-359.999+x else x)
x <- list(1,2,3,4)
x
x[1:2]
lapply(gadm@polygons[[12]]@Polygons[85:95], function(y) y@coords[,1] <-
sapply(y@coords[,1], function(x) if(x<0) x<-359.999+x else x))
for(i in 85:95) gadm@polygons[[12]]@Polygons[85:95]@coodrs[,1]
for(i in 85:95) gadm@polygons[[12]]@Polygons[i]@coodrs[,1]
for(i in 85:95) gadm@polygons[[12]]@Polygons[[i]]@coodrs[,1]
gadm@polygons[[12]]@Polygons[[85]]@coords
for(i in 85:95) print(gadm@polygons[[12]]@Polygons[[i]]@coodrs[,1])
for(i in 85:85) print(gadm@polygons[[12]]@Polygons[[i]]@coodrs[,1])
gadm@polygons[[12]]@Polygons[[85]]@coords[,]
gadm@polygons[[12]]@Polygons[[85]]@coords[,1]
for (i in 85:85) print(gadm@polygons[[12]]@Polygons[[85]]@coords[,1])
for (i in 85:95) print(gadm@polygons[[12]]@Polygons[[85]]@coords[,1])
for (i in 85:95) print(gadm@polygons[[12]]@Polygons[[i\]]@coords[,1])
for (i in 85:95) print(gadm@polygons[[12]]@Polygons[[i]]@coords[,1])
lapply(gadm@polygons[[12]]@Polygons, function(y) sapply(y@coords[,1], function(x) if(x<0) x<-359.999+x else x))
lapply(gadm@polygons[[12]]@Polygons[85:95], function(y) sapply(y@coords[,1], function(x) if(x<0) x<-359.999+x else x))
for(j in 1:length(gadm@polygons[[12]]@Polygons)){
gadm@polygons[[12]]@Polygons[[j]]@coords[,1] <-
sapply(gadm@polygons[[12]]@Polygons[[j]]@coords[,1], function(x) if(x<0) x<-359.999+x else x) }
plot(gadm)
eastern_rus@polygons[1][[1]]@ID
eastern_rus@polygons[[1]]@ID
slot(eastern_rus@polygons[[1]], "ID")
slot(eastern_rus@polygons, "ID")
for (i in 1:length(gadm3@polygons)) eastern_rus@polygons[[i]]@ID <- as.character(eastern_rus@data$ID_1[i])
rus <- merge(fortify(gadm4), gadm4@data, by.x = "id", by.y = "ID_1", all.x = TRUE)
head(rus)
p <- ggplot(data = rus, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = "TYPE_1"), color = "white") +
coord_map(projection = 'azequidist') +
guides(fill=FALSE)
plot(p)
rus <- merge(fortify(gadm4, region = "ID_1"), gadm4@data, by = "ID_1", all.x = TRUE)
p <- ggplot(data = gadm4, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = "TYPE_1"), color = "white") +
coord_map(projection = 'azequidist') +
guides(fill=FALSE)
plot(p)
p <- ggplot(data = gadm4, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = "id"), color = "white") +
coord_map(projection = 'azequidist') +
guides(fill=FALSE)
plot(p)
p <- ggplot(data = gadm4, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = id), color = "white") +
coord_map(projection = 'azequidist') +
guides(fill=FALSE)
plot(p)
gadm4@polygons <- lapply(gadm4@polygons, "comment<-", NULL)
rus <- merge(fortify(gadm4, region = "ID_1"), gadm4@data, by = "ID_1", all.x = TRUE)
rus <- fortify(gadm4, region = "ID_1")
head(rus)
rus <- merge(fortify(gadm4, region = "ID_1"), gadm4@data, by.x = "id", by.y = "ID_1", all.x = TRUE)
p <- ggplot(data = rus, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = id), color = "white") +
coord_map(projection = 'azequidist') +
guides(fill=FALSE)
plot(p)
p <- ggplot(data = rus, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = TYPE_1), color = "white") +
coord_map(projection = 'azequidist') +
guides(fill=FALSE)
plot(p)
gadm4@polygons[[44]]@Polygons[[2]]@hole
plot(gadm4[43:44,])
plot(gadm4[43,])
plot(gadm4[44,])
gadm4@polygons[[44]]@Polygons[[2]]@coords
plot(gadm4@polygons[[44]]@Polygons[[2]])
gadm4@polygons[[44]]@Polygons[[2]]@coords[4,]
gadm4@polygons[[44]]@Polygons[[2]]@coords[4,] <- c(36.5,54.5)
gadm4@polygons[[44]]@Polygons[[2]]@coords[5,] <- c(36.4,54.6)
plot(gadm4[44,])
gadm4@polygons[[44]]@Polygons[[2]]@coords[4,] <- c(36,55)
gadm4@polygons[[44]]@Polygons[[2]]@coords[5,] <- c(35.9,55.1)
plot(gadm4[44,])
gadm4@polygons[[44]]@Polygons[[2]]@coords[5,] <- c(36.9,55.1)
gadm4@polygons[[44]]@Polygons[[2]]@coords[4,] <- c(37,55)
plot(gadm4[44,])
gadm4@polygons[[44]]@Polygons[[1]]@coords
gadm4@polygons[[44]]@Polygons[[2]]@coords[4,] <- c(37.08780, 55.09155)
gadm4@polygons[[44]]@Polygons[[2]]@coords[5,] <- c(37.13385, 55.13167)
plot(gadm4[44,])
gadm4@polygons[[44]]@Polygons[[2]]@coords[5,] <- c(36.97644, 55.21964)
gadm4@polygons[[44]]@Polygons[[2]]@coords[4,] <- c(37.13385, 55.13167)
plot(gadm4[44,])
gadm4@polygons[[44]]@Polygons[[2]]@coords[6,] <- c(36.81909, 55.17616)
plot(gadm4[44,])
plot(gadm4)
gadm4 <- SpatialPolygonsDataFrame(sr, gadm3@data, match.ID = TRUE)
gadm4@polygons[[59]]@Polygons[[1]]@coords <- sr59@polygons[[1]]@Polygons[[1]]@coords
gadm4@polygons[[85]]@Polygons[[1]]@coords <- gadm4@polygons[[85]]@Polygons[[1]]@coords[c(1,7:9,12),]
gadm4@polygons[[43]]@Polygons[[1]]@coords[4,] <- gadm4@polygons[[44]]@Polygons[[1]]@coords[49,]
gadm4@polygons[[43]]@Polygons[[1]]@coords[5,] <- gadm4@polygons[[44]]@Polygons[[1]]@coords[50,]
gadm4@polygons[[44]]@Polygons[[1]]@coords[62:92,] <- gadm4@polygons[[44]]@Polygons[[1]]@coords[50:80,]
gadm4@polygons[[44]]@Polygons[[1]]@coords[50:80,]
gadm4@polygons[[44]]@Polygons[[1]]@coords[62:92,]
gadm4@polygons[[44]]@Polygons[[1]]@coords <- rbind(gadm4@polygons[[44]]@Polygons[[1]]@coords, gadm4@polygons[[44]]@Polygons[[1]]@coords[69:80,])
gadm4@polygons[[44]]@Polygons[[1]]@coords[62:80,] <- gadm4@polygons[[44]]@Polygons[[1]]@coords[50:68,]
gadm4@polygons[[44]]@Polygons[[1]]@coords[50:61,] <- gadm4@polygons[[43]]@Polygons[[1]]@coords[c(3,2,15:6),]
plot(gadm4[44,])
plot(gadm4[43,])
saveRDS(gadm4, "gadm4.Rds")
east <- sapply(lapply(gadm4@polygons, function(x) sapply(x@Polygons, function(y) max(y@coords[,"x"]))), max)
eastern_rus <- gadm4[order(east, decreasing = TRUE),]
for (i in 1:length(gadm3@polygons)) eastern_rus@polygons[[i]]@ID <- as.character(eastern_rus@data$ID_1[i])
for (i in 1:length(gadm4@polygons)) eastern_rus@polygons[[i]]@ID <- as.character(eastern_rus@data$ID_1[i])
gadm4@polygons <- lapply(gadm4@polygons, "comment<-", NULL)
rus <- merge(fortify(gadm4, region = "ID_1"), gadm4@data, by.x = "id", by.y = "ID_1", all.x = TRUE)
p <- ggplot(data = rus, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = TYPE_1), color = "white") +
coord_map(projection = 'azequidist') +
guides(fill=FALSE)
plot(p)
plot(gadm4[85,])
plot(gadm4[84,])
gadm4@polygons[[84]]@Polygons[[1]]@coords
gadm4@polygons[[85]]@Polygons[[1]]@coords
plot(gadm4@polygons[[85]]@Polygons[[1]]@coords)
plot(gadm4@polygons[[84]]@Polygons[[1]]@coords)
plot(gadm4@polygons[[85]]@Polygons[[1]]@coords, add = T, col = "red")
plot(gadm4[84,])
plot(gadm4[85,], add=TRUE, borders = "red")
plot(gadm4[85,], add=TRUE, border = "red")
gadm4@polygons[[84]]@Polygons[[1]]@coords <- gadm4@polygons[[84]]@Polygons[[1]]@coords[-32:36,]
gadm4@polygons[[84]]@Polygons[[1]]@coords <- gadm4@polygons[[84]]@Polygons[[1]]@coords[-c(32:36),]
plot(gadm4[84,])
plot(gadm4[85,], add=TRUE, border = "red")
gadm4@data$NAME_1
plot(gadm4[38,])
plot(gadm4[14,], add=TRUE, border = "red")
gadm4@polygons[[14]]@Polygons
plot(gadm4@polygons[[14]]@Polygons[[1]]@coords)
plot(gadm4@polygons[[14]]@Polygons[[1]]@coords[-c(15:18),])
gadm4@polygons[[14]]@Polygons[[1]]@coords <- gadm4@polygons[[14]]@Polygons[[1]]@coords[-c(15,16),]
rus <- merge(fortify(gadm4, region = "ID_1"), gadm4@data, by.x = "id", by.y = "ID_1", all.x = TRUE)
p <- ggplot(data = rus, aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = TYPE_1), color = "white") +
coord_map(projection = 'azequidist') +
guides(fill=FALSE)
plot(p)
saveRDS(rus, "rus.Rds")
saveRDS(gadm4, "gadm4.Rds")
setwd("~/R/Projects/Russian_Choropleth/")
gadm <- readRDS("RUS_adm2.rds")
plot(gadm)
>>>>>>> 1ecf89e2e080d5f208c82a9f533a949da1b4cf7a
